<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j" template="/layout/template.xhtml">

	<ui:define name="body">
		<style>
.stkPanel {
	height: 200px;
	overflow: auto;
}

.panelBody {
	height: 150px;
	overflow: auto;
}
</style>
		<h1>#{projetoHome.managed?'Editar':'Novo'} Projeto</h1>


		<rich:panel>
			<f:facet name="header">Termo de Abertura de Projeto</f:facet>

			<h:panelGrid columns="2" width="100%" columnClasses="top,top,top,top">
				<h:form id="projeto" styleClass="edit">
					<h:panelGrid columns="2">

						<s:decorate id="nomeField" template="/layout/edit.xhtml">
							<ui:define name="label">Nome do Projeto</ui:define>
							<h:inputText id="nome" size="15"
								value="#{novoProjeto.projeto.nome}" />
						</s:decorate>

						<s:decorate id="clienteField" template="/layout/edit.xhtml">
							<ui:define name="label">Cliente</ui:define>
							<h:inputText id="cliente" size="15"
								value="#{novoProjeto.projeto.cliente}" />
						</s:decorate>
						<s:decorate id="inicioField" template="/layout/edit.xhtml">
							<ui:define name="label">Inicio Previsto</ui:define>
							<rich:calendar id="inicio" required="true"
								value="#{novoProjeto.projeto.inicio}"
								datePattern="MM/dd/yyyy hh:mm a" />
						</s:decorate>

						<s:decorate id="fimprevistoField" template="/layout/edit.xhtml">
							<ui:define name="label">Fim Previsto</ui:define>
							<rich:calendar id="fimprevisto"
								value="#{novoProjeto.projeto.fimprevisto}"
								datePattern="MM/dd/yyyy hh:mm a" />
						</s:decorate>

						<ui:remove>
							<s:decorate id="orcamentoField" template="/layout/edit.xhtml">
								<ui:define name="label">Orcamento Previsto</ui:define>
								<h:inputText id="orcamento"
									value="#{novoProjeto.projeto.orcamento}">
									<a:support event="onblur" reRender="orcamentoField"
										bypassUpdates="true" ajaxSingle="true" />
								</h:inputText>
							</s:decorate>
						</ui:remove>

					</h:panelGrid>
					<ui:remove>
						<s:decorate id="resumoField" template="/layout/edit.xhtml">
							<ui:define name="label">Resumo das condições do projeto</ui:define>
							<h:inputTextarea id="resumo" cols="90" rows="5"
								value="#{novoProjeto.projeto.resumo}" />
						</s:decorate>

						<s:decorate id="justificativaField" template="/layout/edit.xhtml">
							<ui:define name="label">Justificativa do projeto</ui:define>
							<h:inputTextarea id="justificativa" cols="90" rows="5"
								value="#{novoProjeto.projeto.justificativa}" />
						</s:decorate>

						<s:decorate id="necessidadesField" template="/layout/edit.xhtml">
							<ui:define name="label">Necessidades básicas do trabalho a ser realizado</ui:define>
							<h:inputTextarea id="necessidades" cols="90" rows="5"
								value="#{novoProjeto.projeto.necessidades}" />
						</s:decorate>

						<s:decorate id="premissasField" template="/layout/edit.xhtml">
							<ui:define name="label">Premissas iniciais</ui:define>
							<h:inputTextarea id="premissas" cols="90" rows="5"
								value="#{novoProjeto.projeto.premissas}" />
						</s:decorate>

						<s:decorate id="restricoesField" template="/layout/edit.xhtml">
							<ui:define name="label">Restrições iniciais</ui:define>
							<h:inputTextarea id="restricoes" cols="90" rows="5"
								value="#{novoProjeto.projeto.restricoes}" />
						</s:decorate>

						<s:decorate id="produtoField" template="/layout/edit.xhtml">
							<ui:define name="label">Descrição do produto</ui:define>
							<h:inputTextarea id="produto" cols="90" rows="5"
								value="#{novoProjeto.projeto.produto}" />
						</s:decorate>

						<s:decorate id="responsabilidadesgpField"
							template="/layout/edit.xhtml">
							<ui:define name="label">Responsabilidades do gerente de projetos</ui:define>
							<h:inputTextarea id="responsabilidadesgp" cols="90" rows="5"
								value="#{novoProjeto.projeto.responsabilidadesgp}" />
						</s:decorate>
					</ui:remove>
					<div style="clear: both">
						<span class="required">*</span> Campos obrigatórios
					</div>

					<div class="actionButtons">

						<h:commandButton id="save" value="Salvar"
							action="#{novoProjeto.salvarProjeto()}" />

						<input type="button" onclick="history.go(-1)" value="Cancelar" />
					</div>
				</h:form>
				<ui:remove>
					<s:decorate id="stakeholdersField" template="/layout/display.xhtml">
						<ui:define name="label">Stakeholders</ui:define>
						<h:form>
							<a4j:commandLink value="Adicionar"
								action="#{novoProjeto.cleanStakeholder()}"
								oncomplete="#{rich:component('usuarioSearch')}.show()"
								reRender="usuarioSearch" rendered="#{!projetoHome.managed}" />
						</h:form>
						<h:outputText value="Nenhum Stakeholder ..."
							rendered="#{novoProjeto.projeto.stakeholders.size() == 0}" />
						<rich:panel bodyClass="stkPanel"
							rendered="#{novoProjeto.projeto.stakeholders.size() gt 0}">
							<rich:dataTable
								value="#{novoProjeto.projeto.stakeholders.toArray()}" var="stk">
								<rich:column>
									<f:facet name="header">Nome</f:facet>
									<h:outputText value="#{stk.usuario.nome}" />
								</rich:column>
								<rich:column>
									<f:facet name="header">Papel</f:facet>
									<h:outputText value="#{stk.papel}" />
								</rich:column>
								<rich:column>
									<f:facet name="header">CCB?</f:facet>
									<h:outputText value="#{stk.ccb?'Sim':'Não'}" />
								</rich:column>
								<rich:column rendered="#{!projetoHome.managed}">
									<f:facet name="header">Ação</f:facet>
									<h:form>
										<a4j:commandLink value="Remover" reRender="stakeholdersField"
											action="#{novoProjeto.removeStakeholder(stk)}">
										</a4j:commandLink>
									</h:form>
								</rich:column>
							</rich:dataTable>
						</rich:panel>
					</s:decorate>
				</ui:remove>
			</h:panelGrid>

		</rich:panel>
		<ui:remove>
			<rich:modalPanel id="usuarioSearch" autosized="true">
				<f:facet name="header">
					<h:panelGroup>
						<h:outputText value="Criar Stakeholder"></h:outputText>
					</h:panelGroup>
				</f:facet>
				<f:facet name="controls">
					<h:panelGroup>
						<h:graphicImage value="/img/close.png" styleClass="hidelink"
							id="hidelink" />
						<rich:componentControl for="usuarioSearch" attachTo="hidelink"
							operation="hide" event="onclick" />
					</h:panelGroup>
				</f:facet>
				<h:form id="stkForm">
					<rich:simpleTogglePanel switchType="client">
						<f:facet name="header">Adicionar Stakeholder</f:facet>
						<h:panelGrid>
							<s:decorate template="/layout/display.xhtml">
								<ui:define name="label">Usuário Selecionado</ui:define>
								<h:outputText value="#{novoProjeto.stakeholder.usuario.nome}" />
							</s:decorate>

							<s:decorate id="papelField" template="/layout/edit.xhtml">
								<ui:define name="label">Papel</ui:define>
								<h:inputText value="#{novoProjeto.stakeholder.papel}"
									required="true">
									<a4j:support event="onblur" reRender="papelField"
										bypassUpdates="true" ajaxSingle="true" />
								</h:inputText>
							</s:decorate>

							<s:decorate id="ccbField" template="/layout/edit.xhtml">
								<ui:define name="label">CCB</ui:define>

								<h:selectBooleanCheckbox value="#{novoProjeto.stakeholder.ccb}"
									required="true">
									<a4j:support event="onblur" reRender="ccbField"
										bypassUpdates="true" ajaxSingle="true" />
								</h:selectBooleanCheckbox>
							</s:decorate>

							<h:panelGrid columns="2" columnClasses="actionButtons">
								<a4j:commandButton id="addButon" value="Adicionar"
									rendered="#{novoProjeto.stakeholder.usuario != null}"
									action="#{novoProjeto.addStakeholder()}"
									reRender="stkForm,stakeholdersField,stkMsg" />
								<h:messages id="stkMsg" styleClass="message"
									errorClass="errormsg" infoClass="infomsg" warnClass="warnmsg" />
							</h:panelGrid>
						</h:panelGrid>
					</rich:simpleTogglePanel>
				</h:form>
				<h:form id="usrForm">
					<rich:simpleTogglePanel switchType="client">
						<f:facet name="header">Busca de usuários</f:facet>
						<h:panelGrid columns="2">
							<s:decorate template="/layout/display.xhtml">
								<ui:define name="label">Email</ui:define>
								<h:inputText id="email" value="#{usuarioList.usuario.email}" />
							</s:decorate>

							<s:decorate template="/layout/display.xhtml">
								<ui:define name="label">Login</ui:define>
								<h:inputText id="login" value="#{usuarioList.usuario.login}" />
							</s:decorate>
						</h:panelGrid>
						<a4j:commandButton id="buscar" value="buscar"
							reRender="usuarioList" />
					</rich:simpleTogglePanel>
				</h:form>

				<a4j:outputPanel id="usuarioList" ajaxRendered="true">
					<rich:panel bodyClass="panelBody">
						<rich:dataTable var="_usuario" value="#{usuarioList.resultList}"
							rendered="#{not empty usuarioList.resultList}">
							<h:column>
								<f:facet name="header">
									<ui:include src="/layout/sort.xhtml">
										<ui:param name="entityList" value="#{usuarioList}" />
										<ui:param name="propertyLabel" value="Nome" />
										<ui:param name="propertyPath" value="usuario.nome" />
									</ui:include>
								</f:facet>
								<h:outputText value="#{_usuario.nome}" />
							</h:column>
							<h:column>
								<f:facet name="header">
									<ui:include src="/layout/sort.xhtml">
										<ui:param name="entityList" value="#{usuarioList}" />
										<ui:param name="propertyLabel" value="Login" />
										<ui:param name="propertyPath" value="usuario.login" />
									</ui:include>
								</f:facet>
								<h:outputText value="#{_usuario.login}" />
							</h:column>

							<h:column>
								<f:facet name="header">
									<ui:include src="/layout/sort.xhtml">
										<ui:param name="entityList" value="#{usuarioList}" />
										<ui:param name="propertyLabel" value="Email" />
										<ui:param name="propertyPath" value="usuario.email" />
									</ui:include>
								</f:facet>
								<h:outputText value="#{_usuario.email}" />
							</h:column>
							<rich:column styleClass="action">
								<f:facet name="header">Action</f:facet>
								<h:form>
									<a4j:commandButton value="Selecionar" reRender="stkForm"
										action="#{novoProjeto.addUsuario(_usuario)}" />
								</h:form>
							</rich:column>
						</rich:dataTable>
					</rich:panel>
				</a4j:outputPanel>
			</rich:modalPanel>
		</ui:remove>
	</ui:define>
</ui:composition>